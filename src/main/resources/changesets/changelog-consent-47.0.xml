<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet author="grushton" id="134">
        <dropForeignKeyConstraint baseTableName="user_role" constraintName="fkRole" />
        <dropForeignKeyConstraint baseTableName="user_role" constraintName="fkUser" />
        <dropPrimaryKey tableName="user_role" />
        <addColumn tableName="user_role">
            <column name="user_role_id"
                    type="bigint"
                    autoIncrement="true"
                    incrementBy="1"
                    beforeColumn="0">
                <constraints primaryKey="true"
                             nullable="false"
                             deferrable="true"
                             initiallyDeferred="false" />
            </column>
        </addColumn>
        <renameColumn tableName="user_role"
                      newColumnName="role_id"
                      oldColumnName="roleId"
                      columnDataType="bigint" />
        <renameColumn tableName="user_role"
                      newColumnName="user_id"
                      oldColumnName="dacUserId"
                      columnDataType="bigint" />


        <addColumn tableName="user_role">
            <column name="dac_id" type="bigint" >
                <constraints
                        foreignKeyName="fk_user_role_dac_id"
                        deleteCascade="false"
                        deferrable="false"
                        initiallyDeferred="false"
                        referencedTableName="dac"
                        referencedColumnNames="dac_id"/>
            </column>
        </addColumn>
        <addForeignKeyConstraint baseTableName="user_role"
                                 baseColumnNames="user_id"
                                 constraintName="fk_user_role_user_id"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedTableName="dacuser"
                                 referencedColumnNames="dacUserId" />
        <addForeignKeyConstraint baseTableName="user_role"
                                 baseColumnNames="role_id"
                                 constraintName="fk_user_role_role_id"
                                 onDelete="NO ACTION"
                                 onUpdate="NO ACTION"
                                 referencedTableName="roles"
                                 referencedColumnNames="roleId" />
    </changeSet>

</databaseChangeLog>
